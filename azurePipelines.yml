trigger:
  branches:
    include:
      - '*'
pr:
  branches:
    include:
      - '*'
jobs:
  - job: Build
    pool:
      vmImage: 'ubuntu-16.04'    
    variables:
      jdk_version: 1.8
    steps:
      - checkout: self
        clean: true
      - bash: |
          git config --global user.email "mastercoms@tuta.io"
          git config --global user.name "mastercoms"  
        displayName: Configure Git
      - bash: ./glowkit p
        displayName: Apply Patches
        # TODO once Azure Pipelines adds caching: create/update a Maven cache with:
        # - bash: (cd Glowkit-Patched && mvn -T 1C -B dependency:go-offline)
        #   displayName: Download Maven Dependencies
        #   env:
        #     JAVA_HOME: $(zuluLinuxLatest)
      - task: Maven@3
        displayName: "Maven: Build"
        inputs:
          mavenOptions: '-Xmx2048m'
          mavenPOMFile: Glowkit-Patched/pom.xml
          javaHomeOption: "JDKVersion"
          jdkVersionOption: "$(jdk_version)"
          jdkArchitectureOption: "x64"
          publishJUnitResults: true
          testResultsFiles: '**/surefire-reports/TEST-*.xml'
          goals: "package -Pbuild-extras"
          options: "--batch-mode"
      - task: PublishBuildArtifacts@1
        displayName: Publish Jar
        inputs:
          pathtoPublish: Glowkit-Patched/target/glowkit.jar
          artifactName: Glowkit
      - task: PublishBuildArtifacts@1
        displayName: Publish POM
        inputs:
          pathtoPublish: Glowkit-Patched/pom.xml
          artifactName: Glowkit POM
